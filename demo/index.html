<!DOCTYPE html>
<html>
    <head>
        <title>Bars Demo</title>
        <script id="bars-template-title-u" type="text/x-handlebars-template">
            <span>{{@upperCase(tt)}}</span>
        </script>
        <script id="bars-template-title-l" type="text/x-handlebars-template">
            <span>{{@lowerCase(tt)}}</span>
        </script>
        <script id="bars-template" type="text/x-handlebars-template">
<h2>To Do</h2>
<input id="new-list" data:{{this}}/>
<ul>
{{#with todos=todos}}
{{#each todos todo=this}}
    <li>
        <span>{{text}}</span> |
        <span class="list-complete" data:{{this}}>{{(complete && 'done') || 'not done' }}</span>
        | <span class="list-del" data:{{todo}} todos:{{todos}}>delete</span>
    </li>
{{else}}
<li>
    <span>Nothing left to do.</span>
</li>
{{/each}}
{{/with}}
</ul>
        </script>
        <script src="bars-app.js"></script>
    </head>
    <body>
        <div id="bars-output" class="som"></div>
        <script type="text/javascript">
        var indexTemplate = document.getElementById('bars-template').innerHTML,
        tuTemplate = document.getElementById('bars-template-title-u').innerHTML,
        tlTemplate = document.getElementById('bars-template-title-l').innerHTML;

        app = new App({
            index: indexTemplate,
            partials: {
                tu: tuTemplate,
                tl: tlTemplate,
            },
            transforms:{
                sbl: function (arr) {
                    return arr.sort(function (a,b){
                        return a.name.length - b.name.length;
                    });
                }
            }
        },
        {
            todos: []
        });

        app.on('click', '.list-complete', function (evt, $el){
            var data = $el.prop('data')('data');
            data.complete = !data.complete;
            app.render();
        });

        app.on('click', '.list-del', function (evt, $el){
            var data = $el.prop('data')('data');
            var todos = $el.prop('data')('todos');

            todos.splice(todos.indexOf(data), 1);

            app.render();
        });

        app.on('change', '#new-list', function (evt, $el){
            var state = $el.prop('data')('data');
            state.todos.unshift({
                text: $el.val()
            });
            $el.val('');
            app.render();
        });

        app.appendTo('#bars-output');


        /*
         * now open you Inspector
         * and try changing barsData
         * and updating the domFrag
         */
        </script>
    </body>
</html>
