<!DOCTYPE html>
<html>
    <head>
        <title>Bars Test</title>
        <script id="bars-template" type="text/x-handlebars-template"></script>
        <script src="bars.js"></script>
    </head>
    <body>
        <div id="bars-output" style="padding: 20px;"></div>
        <div id="test-output" style="border-top: 2px solid red; padding: 20px;">
            <h2>Tests:</h2>
        </div>
        <script type="text/javascript">
            function test(testName, func, expects) {
                var barsOut = document.getElementById('bars-output'),
                    testOut = document.getElementById('test-output');

                barsOut.innerHTML = '';

                func();

                if (barsOut.innerHTML === expects) {
                    testOut.innerHTML += '<span>PASSED: ' + testName + '</span><br>';
                } else {
                    console.debug(
                        'TEST: FAILED' + testName,
                        ' - Actual: "' + barsOut.innerHTML + '"',
                        'Expected: "' + expects + '"'
                    );
                    testOut.innerHTML += '<span>FAILED: ' + testName + ' - check console for more details.</span><br>';
                }
            }
        </script>
        <script type="text/javascript">
            var bars = window.Bars.create(),
                barsOut = document.getElementById('bars-output');

            test('Empty Undefined', function() {
                var template = '{{a}} : {{b}} : {{c}} : {{d}} : {{e/f}}';

                domFrag = bars.compile(template).render();
                domFrag.appendTo(barsOut);

                domFrag.update({ a: undefined, b: null, c: void(0), d: 0 });
            }, ' :  :  : 0 : ');

            test('Bars Transfrom', function() {
                var template = '{{@upperCase(name)}} - {{@lowerCase(name)}}';

                domFrag = bars.compile(template).render();
                domFrag.appendTo(barsOut);

                domFrag.update({ name: 'John'});
            }, 'JOHN - john');

            test('Loops In Loops', function() {
                var template = '{{#each a}}{{#each b}}{{.}}{{/each}}{{/each}}';

                domFrag = bars.compile(template).render();
                domFrag.appendTo(barsOut);

                domFrag.update({ a: { 0: { b: { 0: 'a', 1: 'b', 2: 'c' } }, 1: { b: { 0: 'a', 1: 'b', 2: 'c' } }, 2: { b: { 0: 'a', 1: 'b', 2: 'c' } }, 3: { b: { 0: 'a', 1: 'b', 2: 'c' } } } });
            }, 'abcabcabcabc');

            test('Array Update', function() {
                var cats = [{ name: 'A' }, { name: 'B' }, { name: 'C' }, { name: 'D' }],
                    template = '<ul>{{#each cats}}<li>{{name}}</li>{{/each}}</ul>',
                    data = { cats: cats };


                domFrag = bars.compile(template).render();
                domFrag.appendTo(barsOut);

                domFrag.update(data);

                delete cats[1];
                delete cats[3];

                domFrag.update(data);
            }, '<ul><li>A</li><li>C</li></ul>');

            test('Insert Logic', function() {
                var template = '{{a - 1}} : {{\'test\' + b}} : {{c * 3}} : {{d / b}} : {{ !e/f}}';

                domFrag = bars.compile(template).render();
                domFrag.appendTo(barsOut);

                domFrag.update({ a: 1, b: 2, c: 3, d: 4 });
            }, '0 : test2 : 9 : 2 : true');

            test('Bars If', function() {
                var template = '{{#if a < 2}}true{{else}}false{{/if}}';

                domFrag = bars.compile(template).render();
                domFrag.appendTo(barsOut);

                domFrag.update({ a: 1, b: 2, c: 3, d: 4 });
            }, 'true');

            test('Bars Insert Property', function() {
                var template = '{{#each a}}{{@number(@index) + 1}}{{/each}}';

                domFrag = bars.compile(template).render();
                domFrag.appendTo(barsOut);

                domFrag.update({ a: [1,2,3,4,5]});
            }, '12345');

            // test('Partial Variables', function() {
            //     bars.registerPartial('partialVariables', 'My name is {{a/first}}{{a/last}}.');
            //     var template = '{{>partialVariables a=me/name}}';
            //     domFrag = bars.compile(template).render();
            //     domFrag.appendTo(barsOut);
            //     domFrag.update({ me: { name: { first: 'D', last: 'R' } } });
            // }, 'My name is DR.');
            //
            // test('Partial Variables', function() {
            //     var template = '{{#each people}}{{>partialVariables root=/people fullName=name initial=name/initial}}{{/each}}',
            //         people = [{ name: { first: 'O', initial: 'D', last: 'R' } }];
            //
            //     bars.registerPartial('partialVariables', '{{root/length}} People - My name is {{fullName/first}}{{initial}}{{fullName/last}}.');
            //
            //     domFrag = bars.compile(template).render();
            //     domFrag.appendTo(barsOut);

            //     domFrag.update({ people: [1] });
            //     domFrag.update({ people: people });
            // }, '1 People - My name is ODR.');
            //
            // test('Helper in Partial', function() {
            //     var template = '{{>p name=name}}';
            //
            //     bars.registerPartial('p', '{{?count name}}');
            //     bars.registerHelper('count', function(str) { return str.length; });
            //
            //     domFrag = bars.compile(template).render();
            //     domFrag.appendTo(barsOut);

            //     domFrag.update({ name: 'dallas' });
            // }, '6');
            //
            // test('Partial With No Variables', function() {
            //     var template = '{{>part}}';
            //
            //     bars.registerPartial('part', '{{name}}');
            //
            //     domFrag = bars.compile(template).render();
            //     domFrag.appendTo(barsOut);

            //     domFrag.update({ name: 'dallas' });
            // }, 'PARTIAL');
            //
            // test('HTML Escape', function() {
            //     var template = '{{#if a}}{{{a}}}{{/if}}';

            //     domFrag = bars.compile(template).render();
            //     domFrag.appendTo(barsOut);

            //     domFrag.update({ a: '<h1>This is an H1 tag!</h1>' });
            //     domFrag.update({});
            //     domFrag.update({ a: '<h3>This is an H3 tag!</h3>' });
            // }, '<h3>This is an H3 tag!</h3>');

            /*
             * now open you Inspector
             * and try changing barsData
             * and updating the domFrag
             */
        </script>
    </body>
</html>
